{% extends "base.html" %}
{% block css %}
<link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />
{% endblock %}
{% block script %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
<script>
function select_location(bird, sel) {
  selected = sel.value
  url = '/bird/location/' + bird + '/' + selected
  token = $.cookie('birdsong-token')
  $.ajax({
      url: url,
      headers: {"Authorization": 'Bearer ' + token },
      type: 'POST',
      dataType: 'json',
      contentType:'application/json',
      success: function(result) {
        alert("This bird's location has been changed");
        window.location.href = window.location.pathname 
      },
      error: function (xhr, ajaxOptions, thrownError) {
        if (xhr.status == 401) {
          alert("You are not authenticated");
        }
        else {
          alert(xhr.status + ': ' + thrownError + "\n" + xhr.responseText);
        }
      }
  });
}

function select_nest(bird, sel) {
  if (!sel.value) {
    return;
  }
  selected = sel.value
  url = '/bird/nest/' + bird + '/' + selected
  token = $.cookie('birdsong-token')
  $.ajax({
      url: url,
      headers: {"Authorization": 'Bearer ' + token },
      type: 'POST',
      dataType: 'json',
      contentType:'application/json',
      success: function(result) {
        alert("This bird's nest has been changed");
        window.location.href = window.location.pathname 
      },
      error: function (xhr, ajaxOptions, thrownError) {
        if (xhr.status == 401) {
          alert("You are not authenticated");
        }
        else {
          alert(xhr.status + ': ' + thrownError + "\n" + xhr.responseText);
        }
      }
  });
}

function update_bird(bird, operation) {
  url = '/bird/' + operation + '/' + bird
  token = $.cookie('birdsong-token')
  $.ajax({
      url: url,
      headers: {"Authorization": 'Bearer ' + token },
      type: 'POST',
      dataType: 'json',
      contentType:'application/json',
      success: function(result) {
        if (operation == "alive") {
          alert("This bird has been reported as alive");
        }
        else if (operation == "dead") {
          alert("This bird has been reported as dead");
        }
        else if (operation == "unclaim") {
          alert("This bird has been unclaimed");
        }
        else {
          alert("This bird has been claimed");
        }
        window.location.href = window.location.pathname 
      },
      error: function (xhr, ajaxOptions, thrownError) {
        if (xhr.status == 401) {
          alert("You are not authenticated");
        }
        else {
          alert(xhr.status + ': ' + thrownError + "\n" + xhr.responseText);
        }
      }
  });
}
</script>
{% endblock %}
{% block onload %}
onload="tableInitialize();"
{% endblock %}

{% block content %}
  {{navbar|safe}}
  <h2>Bird {{ bird }}</h2>
  <table id='birdprops' class="property">
  <tbody>
  {% for row in bprops %}
    <tr><td>{{ row[0] }}</td><td>{{ row[1]|safe }}</td></tr>
  {% endfor %}
  </tbody>
  </table>
  {{controls|safe}}
  {{events|safe}}
{% endblock %}
